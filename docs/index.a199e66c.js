!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=this.pos.x*n+n/2,o=this.pos.y*r+r/2,a=.15*n;t.beginPath(),t.arc(i,o,a,0,2*Math.PI,!1),this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill()),t.closePath()}}function a(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=.4*n,o=.6*r,a=this.pos.x*n+.5*(n-i),l=this.pos.y*r+.5*(r-o);this.isWhite?(t.strokeStyle="rgb(0,0,0)",t.strokeRect(a,l,i,o)):(t.fillStyle="rgb(0,0,0)",t.fillRect(a,l,i,o))}}function l(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=.5*n,o=.2*n,a=.3*n,l=.6*n,u=.5*-a,s=.5*-l,c=this.pos.x*n+i,f=this.pos.y*r+i;t.translate(c,f),this.isWhite||t.scale(-1,1),t.beginPath(),t.moveTo(u,s),t.lineTo(u+i,s),t.lineTo(u+i,s+o),t.lineTo(u+a,s+o),t.lineTo(u+a,s+l),t.lineTo(u,s+l),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function u(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=.4*n,o=.6*r,a=this.pos.x*n+.5*n,l=this.pos.y*r+.5*(r-o);t.beginPath(),t.moveTo(a,l),t.lineTo(a+.5*i,l+o),t.lineTo(a-.5*i,l+o),t.closePath(),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function s(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=.6*n,o=.1*n,a=.1*r,l=.6*r,u=.5*(n-a)-.5*n,s=.5*(r-l)-.5*r,c=this.pos.x*n+.5*n,f=this.pos.y*r+.5*r;t.translate(c,f),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(u,s),t.lineTo(u+a,s),t.lineTo(u+a,s+.5*(l-o)),t.lineTo(u+a+.5*(i-a),s+.5*(l-o)),t.lineTo(u+a+.5*(i-a),s+.5*(l+o)),t.lineTo(u+a,s+.5*(l+o)),t.lineTo(u+a,s+l),t.lineTo(u,s+l),t.lineTo(u,s+.5*(l+o)),t.lineTo(u-.5*(i-a),s+.5*(l+o)),t.lineTo(u-.5*(i-a),s+.5*(l-o)),t.lineTo(u,s+.5*(l-o)),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function c(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){var t=e.ctx,n=e.cellWidth,r=e.cellHeight,i=.6*n,o=.2*n,a=.2*r,l=.6*r,u=.5*(n-a)-.5*n,s=.5*(r-l)-.5*r,c=this.pos.x*n+.5*n,f=this.pos.y*r+.5*r;t.translate(c,f),t.beginPath(),t.moveTo(u,s),t.lineTo(u+a,s),t.lineTo(u+a,s+.5*(l-o)),t.lineTo(u+a+.5*(i-a),s+.5*(l-o)),t.lineTo(u+a+.5*(i-a),s+.5*(l+o)),t.lineTo(u+a,s+.5*(l+o)),t.lineTo(u+a,s+l),t.lineTo(u,s+l),t.lineTo(u,s+.5*(l+o)),t.lineTo(u-.5*(i-a),s+.5*(l+o)),t.lineTo(u-.5*(i-a),s+.5*(l-o)),t.lineTo(u,s+.5*(l-o)),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}var f="SetUp",h="FEN",p=function(){"use strict";function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t(this,e),this.clear();var r=n.match(/\[([^\]]+)]/g);if(r&&r.length>0)for(var i=0;i<r.length;i++){var o=r[i].match(/\[(\w+)\s+"([^"]+)"/);o&&(this.tags[o[1]]=o[2])}}return r(e,[{key:"clear",value:function(){this.tags={}}},{key:"render",value:function(){var e="";for(var t in this.tags)e+="[".concat(t,' "').concat(this.tags[t],'"]\n');return e}}]),e}();function v(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,v)}function d(e,t){t=void 0!==t?t:{};var n,r={},i={pgn:Oe},o=Oe,a=Se("1:0",!1),l=Se("0:1",!1),u=Se("1-0",!1),s=Se("0-1",!1),c="1/2-1/2",f=Se("1/2-1/2",!1),h=Se("*",!1),p=/^[^}]/,d=ke(["}"],!0,!1),g=Se("{",!1),m=Se("}",!1),y=Se("(",!1),b=Se(")",!1),A=".",E=Se(".",!1),C=Te("integer"),w=/^[0-9]/,x=ke([["0","9"]],!1,!1),S=function(e){return parseInt(e.join(""),10)},k=Se(" ",!1),T="O-O-O",_=Se("O-O-O",!1),P=Se("O-O",!1),R="+-",N=Se("+-",!1),O=Se("+",!1),I=function(e){return e[1]},L=Se("$$$",!1),$=Se("#",!1),B=Se("=",!1),Q=Se("$",!1),q="!!",K=Se("!!",!1),U="??",D=Se("??",!1),j="!?",M=Se("!?",!1),W="?!",F=Se("?!",!1),H=Se("!",!1),G=Se("?",!1),z=Se("‼",!1),V=Se("⁇",!1),Z=Se("⁉",!1),J=Se("⁈",!1),X=Se("□",!1),Y=Se("∞",!1),ee=Se("⩲",!1),te=Se("⩱",!1),ne=Se("±",!1),re=Se("∓",!1),ie="-+",oe=Se("-+",!1),ae=Se("⨀",!1),le=Se("⟳",!1),ue=Se("→",!1),se=Se("↑",!1),ce=Se("⇆",!1),fe=Se("D",!1),he=/^[RNBQKP]/,pe=ke(["R","N","B","Q","K","P"],!1,!1),ve=/^[a-h]/,de=ke([["a","h"]],!1,!1),ge=/^[1-8]/,me=ke([["1","8"]],!1,!1),ye=Se("x",!1),be=Se("-",!1),Ae=0,Ee=[{line:1,column:1}],Ce=0,we=[],xe=0;if("startRule"in t){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=i[t.startRule]}function Se(e,t){return{type:"literal",text:e,ignoreCase:t}}function ke(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Te(e){return{type:"other",description:e}}function _e(t){var n,r=Ee[t];if(r)return r;for(n=t-1;!Ee[n];)n--;for(r={line:(r=Ee[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Ee[t]=r,r}function Pe(e,t){var n=_e(e),r=_e(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function Re(e){Ae<Ce||(Ae>Ce&&(Ce=Ae,we=[]),we.push(e))}function Ne(e,t,n){return new v(v.buildMessage(e,t),e,t,n)}function Oe(){var e,t,n,i,o;return e=Ae,t=function(){var e,t;e=Ae,(t=Le())!==r&&(e,t=t);return e=t}(),t!==r?((n=$e())===r&&(n=null),n!==r?(e,i=t,(o=n||[]).unshift(i),e=t=o):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Ae,(t=Ie())!==r?((n=Le())===r&&(n=null),n!==r?(e,t=function(e,t){var n=t||[];return n.unshift(e),n}(t,n),e=t):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Ae,(t=Me())===r&&(t=null),t!==r&&(e,t=[[]]),e=t)),e}function Ie(){var e,t;return e=Ae,(t=$e())!==r&&(e,t=t),e=t}function Le(){var t,n,i,o,a,l,u,s,c,f,h,p,v,d,g,m,y,b,C,w,x,S,k,T;return t=Ae,(n=Me())===r&&(n=null),n!==r?((i=Qe())===r&&(i=null),i!==r?((o=Me())===r&&(o=null),o!==r?(a=function(){var t,n,i;t=Ae,(n=je())!==r?(46===e.charCodeAt(Ae)?(i=A,Ae++):(i=r,0===xe&&Re(E)),i===r&&(i=null),i!==r?(t,t=n=n):(Ae=t,t=r)):(Ae=t,t=r);return t}(),a===r&&(a=null),a!==r?((l=Me())===r&&(l=null),l!==r?((u=Qe())===r&&(u=null),u!==r?((s=Me())===r&&(s=null),s!==r&&(c=We())!==r?((f=Me())===r&&(f=null),f!==r?((h=Ge())===r&&(h=null),h!==r?((p=Me())===r&&(p=null),p!==r?((v=Qe())===r&&(v=null),v!==r?((d=Me())===r&&(d=null),d!==r?((g=qe())===r&&(g=null),g!==r?((m=$e())===r&&(m=null),m!==r?(t,y=i,b=u,C=c,w=h,x=v,S=g,k=m||[],(T={turn:"w"}).moveNumber=a,T.notation=C,T.commentBefore=b,T.commentAfter=x,T.commentMove=y,T.variations=S||[],T.nag=w||null,k.unshift(T),t=n=k):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Be()),t}function $e(){var e,t,n,i,o,a,l,u,s,c,f,h,p,v,d,g,m,y,b,A,E,C,w;return e=Ae,(t=Me())===r&&(t=null),t!==r?((n=Qe())===r&&(n=null),n!==r?((i=Me())===r&&(i=null),i!==r?((o=Ve())===r&&(o=null),o!==r?((a=Me())===r&&(a=null),a!==r?((l=Qe())===r&&(l=null),l!==r?((u=Me())===r&&(u=null),u!==r&&(s=We())!==r?((c=Me())===r&&(c=null),c!==r?((f=Ge())===r&&(f=null),f!==r?((h=Me())===r&&(h=null),h!==r?((p=Qe())===r&&(p=null),p!==r?((v=Me())===r&&(v=null),v!==r?((d=Ke())===r&&(d=null),d!==r?((g=Le())===r&&(g=null),g!==r?(e,m=l,y=s,b=f,A=p,E=d,C=g||[],(w={turn:"b"}).moveNumber=o,w.notation=y,w.commentBefore=m,w.commentAfter=A,w.variations=E||[],C.unshift(w),w.nag=b||null,e=t=C):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Be()),e}function Be(){var t,n;return t=Ae,"1:0"===e.substr(Ae,3)?(n="1:0",Ae+=3):(n=r,0===xe&&Re(a)),n!==r&&(t,n=["1:0"]),(t=n)===r&&(t=Ae,"0:1"===e.substr(Ae,3)?(n="0:1",Ae+=3):(n=r,0===xe&&Re(l)),n!==r&&(t,n=["0:1"]),(t=n)===r&&(t=Ae,"1-0"===e.substr(Ae,3)?(n="1-0",Ae+=3):(n=r,0===xe&&Re(u)),n!==r&&(t,n=["1-0"]),(t=n)===r&&(t=Ae,"0-1"===e.substr(Ae,3)?(n="0-1",Ae+=3):(n=r,0===xe&&Re(s)),n!==r&&(t,n=["0-1"]),(t=n)===r&&(t=Ae,e.substr(Ae,7)===c?(n=c,Ae+=7):(n=r,0===xe&&Re(f)),n!==r&&(t,n=["1/2-1/2"]),(t=n)===r&&(t=Ae,42===e.charCodeAt(Ae)?(n="*",Ae++):(n=r,0===xe&&Re(h)),n!==r&&(t,n=["*"]),t=n))))),t}function Qe(){var t,n,i,o;if(t=Ae,n=function(){var t;123===e.charCodeAt(Ae)?(t="{",Ae++):(t=r,0===xe&&Re(g));return t}(),n!==r){for(i=[],p.test(e.charAt(Ae))?(o=e.charAt(Ae),Ae++):(o=r,0===xe&&Re(d));o!==r;)i.push(o),p.test(e.charAt(Ae))?(o=e.charAt(Ae),Ae++):(o=r,0===xe&&Re(d));i!==r?(o=function(){var t;125===e.charCodeAt(Ae)?(t="}",Ae++):(t=r,0===xe&&Re(m));return t}(),o!==r?(t,t=n=i.join("").trim()):(Ae=t,t=r)):(Ae=t,t=r)}else Ae=t,t=r;return t}function qe(){var e,t,n,i,o,a,l,u;return e=Ae,Ue()!==r&&(t=Le())!==r&&De()!==r?((n=Me())===r&&(n=null),n!==r?((i=qe())===r&&(i=null),i!==r?((o=Me())===r&&(o=null),o!==r?((a=Ve())===r&&(a=null),a!==r?(e,l=t,(u=i||[]).unshift(l),e=u):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e}function Ke(){var e,t,n,i,o,a;return e=Ae,Ue()!==r&&(t=Ie())!==r&&De()!==r?((n=Me())===r&&(n=null),n!==r?((i=Ke())===r&&(i=null),i!==r?(e,o=t,(a=i||[]).unshift(o),e=a):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e}function Ue(){var t;return 40===e.charCodeAt(Ae)?(t="(",Ae++):(t=r,0===xe&&Re(y)),t}function De(){var t;return 41===e.charCodeAt(Ae)?(t=")",Ae++):(t=r,0===xe&&Re(b)),t}function je(){var t,n,i;if(xe++,t=Ae,n=[],w.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=r,0===xe&&Re(x)),i!==r)for(;i!==r;)n.push(i),w.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=r,0===xe&&Re(x));else n=r;return n!==r&&(t,n=S(n)),xe--,(t=n)===r&&(n=r,0===xe&&Re(C)),t}function Me(){var t,n,i;if(t=Ae,n=[],32===e.charCodeAt(Ae)?(i=" ",Ae++):(i=r,0===xe&&Re(k)),i!==r)for(;i!==r;)n.push(i),32===e.charCodeAt(Ae)?(i=" ",Ae++):(i=r,0===xe&&Re(k));else n=r;return n!==r&&(t,n=""),t=n}function We(){var t,n,i,o,a,l,u,s,c,f,h,p,v,d,g,m,y;return t=Ae,(n=Ze())===r&&(n=null),n!==r?(i=Ae,xe++,o=function(){var e,t,n,i,o;e=Ae,(t=ze())!==r?((n=Ye())===r&&(n=null),n!==r&&(i=Je())!==r&&(o=Xe())!==r?e=t=[t,n,i,o]:(Ae=e,e=r)):(Ae=e,e=r);return e}(),xe--,o!==r?(Ae=i,i=void 0):i=r,i!==r&&(o=ze())!==r?((a=Ye())===r&&(a=null),a!==r&&(l=Je())!==r&&(u=Xe())!==r?((s=He())===r&&(s=null),s!==r?((c=Fe())===r&&(c=null),c!==r?(t,h=o,p=a,v=l,d=u,g=s,m=c,(y={}).fig=(f=n)||null,y.disc=h||null,y.strike=p||null,y.col=v,y.row=d,y.check=m||null,y.promotion=g,y.notation=(f||"")+(h||"")+(p||"")+v+d+(g||"")+(m||""),t=n=y):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,(n=Ze())===r&&(n=null),n!==r&&(i=Je())!==r&&(o=Xe())!==r?(a=function(){var t;120===e.charCodeAt(Ae)?(t="x",Ae++):(t=r,0===xe&&Re(ye));t===r&&(45===e.charCodeAt(Ae)?(t="-",Ae++):(t=r,0===xe&&Re(be)));return t}(),a===r&&(a=null),a!==r&&(l=Je())!==r&&(u=Xe())!==r?((s=He())===r&&(s=null),s!==r?((c=Fe())===r&&(c=null),c!==r?(t,n=function(e,t,n,r,i,o,a,l){var u={};return u.fig=e||null,u.strike="x"==r?r:null,u.col=i,u.row=o,u.check=l||null,u.notation=(e&&"P"!==e?e:"")+t+n+("x"==r?r:"-")+i+o+(a||"")+(l||""),u.promotion=a,u}(n,i,o,a,l,u,s,c),t=n):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,(n=Ze())===r&&(n=null),n!==r?((i=Ye())===r&&(i=null),i!==r&&(o=Je())!==r&&(a=Xe())!==r?((l=He())===r&&(l=null),l!==r?((u=Fe())===r&&(u=null),u!==r?(t,n=function(e,t,n,r,i,o){var a={};return a.fig=e||null,a.strike=t||null,a.col=n,a.row=r,a.check=o||null,a.notation=(e||"")+(t||"")+n+r+(i||"")+(o||""),a.promotion=i,a}(n,i,o,a,l,u),t=n):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,e.substr(Ae,5)===T?(n=T,Ae+=5):(n=r,0===xe&&Re(_)),n!==r?((i=Fe())===r&&(i=null),i!==r?(t,n=function(e){var t={};return t.notation="O-O-O"+(e||""),t.check=e||null,t}(i),t=n):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,"O-O"===e.substr(Ae,3)?(n="O-O",Ae+=3):(n=r,0===xe&&Re(P)),n!==r?((i=Fe())===r&&(i=null),i!==r?(t,n=function(e){var t={};return t.notation="O-O"+(e||""),t.check=e||null,t}(i),t=n):(Ae=t,t=r)):(Ae=t,t=r))))),t}function Fe(){var t,n,i,o;return t=Ae,n=Ae,i=Ae,xe++,e.substr(Ae,2)===R?(o=R,Ae+=2):(o=r,0===xe&&Re(N)),xe--,o===r?i=void 0:(Ae=i,i=r),i!==r?(43===e.charCodeAt(Ae)?(o="+",Ae++):(o=r,0===xe&&Re(O)),o!==r?n=i=[i,o]:(Ae=n,n=r)):(Ae=n,n=r),n!==r&&(t,n=I(n)),(t=n)===r&&(t=Ae,n=Ae,i=Ae,xe++,"$$$"===e.substr(Ae,3)?(o="$$$",Ae+=3):(o=r,0===xe&&Re(L)),xe--,o===r?i=void 0:(Ae=i,i=r),i!==r?(35===e.charCodeAt(Ae)?(o="#",Ae++):(o=r,0===xe&&Re($)),o!==r?n=i=[i,o]:(Ae=n,n=r)):(Ae=n,n=r),n!==r&&(t,n=I(n)),t=n),t}function He(){var t,n,i;return t=Ae,61===e.charCodeAt(Ae)?(n="=",Ae++):(n=r,0===xe&&Re(B)),n!==r&&(i=Ze())!==r?(t,t=n="="+i):(Ae=t,t=r),t}function Ge(){var t,n,i,o,a,l;return t=Ae,n=function(){var t,n,i;t=Ae,36===e.charCodeAt(Ae)?(n="$",Ae++):(n=r,0===xe&&Re(Q));n!==r&&(i=je())!==r?(t,t=n="$"+i):(Ae=t,t=r);t===r&&(t=Ae,e.substr(Ae,2)===q?(n=q,Ae+=2):(n=r,0===xe&&Re(K)),n!==r&&(t,n="$3"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===U?(n=U,Ae+=2):(n=r,0===xe&&Re(D)),n!==r&&(t,n="$4"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===j?(n=j,Ae+=2):(n=r,0===xe&&Re(M)),n!==r&&(t,n="$5"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===W?(n=W,Ae+=2):(n=r,0===xe&&Re(F)),n!==r&&(t,n="$6"),(t=n)===r&&(t=Ae,33===e.charCodeAt(Ae)?(n="!",Ae++):(n=r,0===xe&&Re(H)),n!==r&&(t,n="$1"),(t=n)===r&&(t=Ae,63===e.charCodeAt(Ae)?(n="?",Ae++):(n=r,0===xe&&Re(G)),n!==r&&(t,n="$2"),(t=n)===r&&(t=Ae,8252===e.charCodeAt(Ae)?(n="‼",Ae++):(n=r,0===xe&&Re(z)),n!==r&&(t,n="$3"),(t=n)===r&&(t=Ae,8263===e.charCodeAt(Ae)?(n="⁇",Ae++):(n=r,0===xe&&Re(V)),n!==r&&(t,n="$4"),(t=n)===r&&(t=Ae,8265===e.charCodeAt(Ae)?(n="⁉",Ae++):(n=r,0===xe&&Re(Z)),n!==r&&(t,n="$5"),(t=n)===r&&(t=Ae,8264===e.charCodeAt(Ae)?(n="⁈",Ae++):(n=r,0===xe&&Re(J)),n!==r&&(t,n="$6"),(t=n)===r&&(t=Ae,9633===e.charCodeAt(Ae)?(n="□",Ae++):(n=r,0===xe&&Re(X)),n!==r&&(t,n="$7"),(t=n)===r&&(t=Ae,61===e.charCodeAt(Ae)?(n="=",Ae++):(n=r,0===xe&&Re(B)),n!==r&&(t,n="$10"),(t=n)===r&&(t=Ae,8734===e.charCodeAt(Ae)?(n="∞",Ae++):(n=r,0===xe&&Re(Y)),n!==r&&(t,n="$13"),(t=n)===r&&(t=Ae,10866===e.charCodeAt(Ae)?(n="⩲",Ae++):(n=r,0===xe&&Re(ee)),n!==r&&(t,n="$14"),(t=n)===r&&(t=Ae,10865===e.charCodeAt(Ae)?(n="⩱",Ae++):(n=r,0===xe&&Re(te)),n!==r&&(t,n="$15"),(t=n)===r&&(t=Ae,177===e.charCodeAt(Ae)?(n="±",Ae++):(n=r,0===xe&&Re(ne)),n!==r&&(t,n="$16"),(t=n)===r&&(t=Ae,8723===e.charCodeAt(Ae)?(n="∓",Ae++):(n=r,0===xe&&Re(re)),n!==r&&(t,n="$17"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===R?(n=R,Ae+=2):(n=r,0===xe&&Re(N)),n!==r&&(t,n="$18"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===ie?(n=ie,Ae+=2):(n=r,0===xe&&Re(oe)),n!==r&&(t,n="$19"),(t=n)===r&&(t=Ae,10752===e.charCodeAt(Ae)?(n="⨀",Ae++):(n=r,0===xe&&Re(ae)),n!==r&&(t,n="$22"),(t=n)===r&&(t=Ae,10227===e.charCodeAt(Ae)?(n="⟳",Ae++):(n=r,0===xe&&Re(le)),n!==r&&(t,n="$32"),(t=n)===r&&(t=Ae,8594===e.charCodeAt(Ae)?(n="→",Ae++):(n=r,0===xe&&Re(ue)),n!==r&&(t,n="$36"),(t=n)===r&&(t=Ae,8593===e.charCodeAt(Ae)?(n="↑",Ae++):(n=r,0===xe&&Re(se)),n!==r&&(t,n="$40"),(t=n)===r&&(t=Ae,8646===e.charCodeAt(Ae)?(n="⇆",Ae++):(n=r,0===xe&&Re(ce)),n!==r&&(t,n="$132"),(t=n)===r&&(t=Ae,68===e.charCodeAt(Ae)?(n="D",Ae++):(n=r,0===xe&&Re(fe)),n!==r&&(t,n="$220"),t=n)))))))))))))))))))))))));return t}(),n!==r?((i=Me())===r&&(i=null),i!==r?((o=Ge())===r&&(o=null),o!==r?(t,a=n,(l=o||[]).unshift(a),t=n=l):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t}function ze(){var e;return(e=Je())===r&&(e=Xe()),e}function Ve(){var t,n,i,o;if(t=Ae,(n=je())!==r){if(i=[],46===e.charCodeAt(Ae)?(o=A,Ae++):(o=r,0===xe&&Re(E)),o!==r)for(;o!==r;)i.push(o),46===e.charCodeAt(Ae)?(o=A,Ae++):(o=r,0===xe&&Re(E));else i=r;i!==r?(t,t=n=n):(Ae=t,t=r)}else Ae=t,t=r;return t}function Ze(){var t;return he.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===xe&&Re(pe)),t}function Je(){var t;return ve.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===xe&&Re(de)),t}function Xe(){var t;return ge.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===xe&&Re(me)),t}function Ye(){var t;return 120===e.charCodeAt(Ae)?(t="x",Ae++):(t=r,0===xe&&Re(ye)),t}if((n=o())!==r&&Ae===e.length)return n;throw n!==r&&Ae<e.length&&Re({type:"end"}),Ne(we,Ce<e.length?e.charAt(Ce):null,Ce<e.length?Pe(Ce,Ce+1):Pe(Ce,Ce))}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(v,Error),v.buildMessage=function(e,t){var n,r={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,n,i,o=new Array(e.length);for(t=0;t<e.length;t++)o[t]=(i=e[t],r[i.type](i));if(o.sort(),o.length>0){for(t=1,n=1;t<o.length;t++)o[t-1]!==o[t]&&(o[n]=o[t],n++);o.length=n}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}(e)+" but "+(((n=t)?'"'+o(n)+'"':"end of input")+" found.")};var g,m,y,b,A=function(){function e(){t(this,e)}return r(e,null,[{key:"parse",value:function(e,t){return d(e,t)}}]),e}(),E={};g=E,m="Chess",y=function(){return C},b=function(e){return C=e},Object.defineProperty(g,m,{get:y,set:b,enumerable:!0,configurable:!0});
/* @license
 * Copyright (c) 2018, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var C=function(e){var t="b",n="w",r=-1,i="p",o="b",a="k",l="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",u=["1-0","0-1","1/2-1/2","*"],s={b:[16,32,17,15],w:[-16,-32,-17,-15]},c={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},f=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],h=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:0,n:1,b:2,r:3,q:4,k:5},v={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},d={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:g.a1,flag:d.QSIDE_CASTLE},{square:g.h1,flag:d.KSIDE_CASTLE}],b:[{square:g.a8,flag:d.QSIDE_CASTLE},{square:g.h8,flag:d.KSIDE_CASTLE}]},y=new Array(128),b={w:r,b:r},A=n,E={w:0,b:0},C=r,w=0,x=1,S=[],k={};function T(e){void 0===e&&(e=!1),y=new Array(128),b={w:r,b:r},A=n,E={w:0,b:0},C=r,w=0,x=1,S=[],e||(k={}),I(N())}function _(){P(l)}function P(e,i){void 0===i&&(i=!1);var o=e.split(/\s+/),a=o[0],l=0;if(!R(e).valid)return!1;T(i);for(var u=0;u<a.length;u++){var s=a.charAt(u);if("/"===s)l+=8;else if(-1!=="0123456789".indexOf(s))l+=parseInt(s,10);else{var c=s<"a"?n:t;$({type:s.toLowerCase(),color:c},X(l)),l++}}return A=o[1],o[2].indexOf("K")>-1&&(E.w|=d.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(E.w|=d.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(E.b|=d.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(E.b|=d.QSIDE_CASTLE),C="-"===o[3]?r:g[o[3]],w=parseInt(o[4],10),x=parseInt(o[5],10),I(N()),!0}function R(e){var t="No errors.",n="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",i="5th field (half move counter) must be a non-negative integer.",o="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",l="2nd field (side to move) is invalid.",u="1st field (piece positions) does not contain 8 '/'-delimited rows.",s="1st field (piece positions) is invalid [consecutive numbers].",c="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",h="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:n};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:i};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:o};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:l};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:u};for(var d=0;d<v.length;d++){for(var g=0,m=!1,y=0;y<v[d].length;y++)if(isNaN(v[d][y])){if(!/^[prnbqkPRNBQK]$/.test(v[d][y]))return{valid:!1,error_number:9,error:c};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:s};g+=parseInt(v[d][y],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:h}:{valid:!0,error_number:0,error:t}}function N(){for(var e=0,t="",i=g.a8;i<=g.h1;i++){if(null==y[i])e++;else{e>0&&(t+=e,e=0);var o=y[i].color,a=y[i].type;t+=o===n?a.toUpperCase():a.toLowerCase()}i+1&136&&(e>0&&(t+=e),i!==g.h1&&(t+="/"),e=0,i+=8)}var l="";E.w&d.KSIDE_CASTLE&&(l+="K"),E.w&d.QSIDE_CASTLE&&(l+="Q"),E.b&d.KSIDE_CASTLE&&(l+="k"),E.b&d.QSIDE_CASTLE&&(l+="q"),l=l||"-";var u=C===r?"-":X(C);return[t,A,l,u,w,x].join(" ")}function O(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(k[e[t]]=e[t+1]);return k}function I(e){S.length>0||(e!==l?(k.SetUp="1",k.FEN=e):(delete k.SetUp,delete k.FEN))}function L(e){var t=y[g[e]];return t?{type:t.type,color:t.color}:null}function $(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in g))return!1;var n=g[t];return(e.type!=a||b[e.color]==r||b[e.color]==n)&&(y[n]={type:e.type,color:e.color},e.type===a&&(b[e.color]=n),I(N()),!0)}function B(e,t,n,r,o){var a={color:A,from:t,to:n,flags:r,piece:e[t].type};return o&&(a.flags|=d.PROMOTION,a.promotion=o),e[n]?a.captured=e[n].type:r&d.EP_CAPTURE&&(a.captured=i),a}function Q(e){function t(e,t,n,r,a){if(e[n].type!==i||0!==Z(r)&&7!==Z(r))t.push(B(e,n,r,a));else for(var l=["q","r",o,"n"],u=0,s=l.length;u<s;u++)t.push(B(e,n,r,a,l[u]))}var n=[],r=A,a=Y(r),l={b:1,w:6},u=g.a8,f=g.h1,h=!1,p=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in g))return[];u=f=g[e.square],h=!0}for(var v=u;v<=f;v++)if(136&v)v+=7;else{var m=y[v];if(null!=m&&m.color===r)if(m.type===i){var w=v+s[r][0];if(null==y[w]){t(y,n,v,w,d.NORMAL);w=v+s[r][1];l[r]===Z(v)&&null==y[w]&&t(y,n,v,w,d.BIG_PAWN)}for(x=2;x<4;x++){136&(w=v+s[r][x])||(null!=y[w]&&y[w].color===a?t(y,n,v,w,d.CAPTURE):w===C&&t(y,n,v,C,d.EP_CAPTURE))}}else for(var x=0,S=c[m.type].length;x<S;x++){var k=c[m.type][x];for(w=v;!(136&(w+=k));){if(null!=y[w]){if(y[w].color===r)break;t(y,n,v,w,d.CAPTURE);break}if(t(y,n,v,w,d.NORMAL),"n"===m.type||"k"===m.type)break}}}if(!h||f===b[r]){if(E[r]&d.KSIDE_CASTLE){var T=(_=b[r])+2;null!=y[_+1]||null!=y[T]||U(a,b[r])||U(a,_+1)||U(a,T)||t(y,n,b[r],T,d.KSIDE_CASTLE)}if(E[r]&d.QSIDE_CASTLE){var _;T=(_=b[r])-2;null!=y[_-1]||null!=y[_-2]||null!=y[_-3]||U(a,b[r])||U(a,_-1)||U(a,T)||t(y,n,b[r],T,d.QSIDE_CASTLE)}}if(!p)return n;var P=[];for(v=0,S=n.length;v<S;v++)G(n[v]),D(r)||P.push(n[v]),z();return P}function q(e,t){var n="";if(e.flags&d.KSIDE_CASTLE)n="O-O";else if(e.flags&d.QSIDE_CASTLE)n="O-O-O";else{var r=function(e,t){for(var n=Q({legal:!t}),r=e.from,i=e.to,o=e.piece,a=0,l=0,u=0,s=0,c=n.length;s<c;s++){var f=n[s].from,h=n[s].to;o===n[s].piece&&r!==f&&i===h&&(a++,Z(r)===Z(f)&&l++,J(r)===J(f)&&u++)}if(a>0)return l>0&&u>0?X(r):u>0?X(r).charAt(1):X(r).charAt(0);return""}(e,t);e.piece!==i&&(n+=e.piece.toUpperCase()+r),e.flags&(d.CAPTURE|d.EP_CAPTURE)&&(e.piece===i&&(n+=X(e.from)[0]),n+="x"),n+=X(e.to),e.flags&d.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return G(e),j()&&(M()?n+="#":n+="+"),z(),n}function K(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function U(e,r){for(var o=g.a8;o<=g.h1;o++)if(136&o)o+=7;else if(null!=y[o]&&y[o].color===e){var a=y[o],l=o-r,u=l+119;if(f[u]&1<<p[a.type]){if(a.type===i){if(l>0){if(a.color===n)return!0}else if(a.color===t)return!0;continue}if("n"===a.type||"k"===a.type)return!0;for(var s=h[u],c=o+s,v=!1;c!==r;){if(null!=y[c]){v=!0;break}c+=s}if(!v)return!0}}return!1}function D(e){return U(Y(e),b[e])}function j(){return D(A)}function M(){return j()&&0===Q().length}function W(){return!j()&&0===Q().length}function F(){for(var e={},t=[],n=0,r=0,i=g.a8;i<=g.h1;i++)if(r=(r+1)%2,136&i)i+=7;else{var a=y[i];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===o&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e.b||1===e.n))return!0;if(n===e.b+2){var l=0,u=t.length;for(i=0;i<u;i++)l+=t[i];if(0===l||l===u)return!0}return!1}function H(){for(var e=[],t={},n=!1;;){var r=z();if(!r)break;e.push(r)}for(;;){var i=N().split(" ").slice(0,4).join(" ");if(t[i]=i in t?t[i]+1:1,t[i]>=3&&(n=!0),!e.length)break;G(e.pop())}return n}function G(e){var n=A,o=Y(n);if(function(e){S.push({move:e,kings:{b:b.b,w:b.w},turn:A,castling:{b:E.b,w:E.w},ep_square:C,half_moves:w,move_number:x})}(e),y[e.to]=y[e.from],y[e.from]=null,e.flags&d.EP_CAPTURE&&(A===t?y[e.to-16]=null:y[e.to+16]=null),e.flags&d.PROMOTION&&(y[e.to]={type:e.promotion,color:n}),y[e.to].type===a){if(b[y[e.to].color]=e.to,e.flags&d.KSIDE_CASTLE){var l=e.to-1,u=e.to+1;y[l]=y[u],y[u]=null}else if(e.flags&d.QSIDE_CASTLE){l=e.to+1,u=e.to-2;y[l]=y[u],y[u]=null}E[n]=""}if(E[n])for(var s=0,c=m[n].length;s<c;s++)if(e.from===m[n][s].square&&E[n]&m[n][s].flag){E[n]^=m[n][s].flag;break}if(E[o])for(s=0,c=m[o].length;s<c;s++)if(e.to===m[o][s].square&&E[o]&m[o][s].flag){E[o]^=m[o][s].flag;break}C=e.flags&d.BIG_PAWN?"b"===A?e.to-16:e.to+16:r,e.piece===i||e.flags&(d.CAPTURE|d.EP_CAPTURE)?w=0:w++,A===t&&x++,A=Y(A)}function z(){var e=S.pop();if(null==e)return null;var n=e.move;b=e.kings,A=e.turn,E=e.castling,C=e.ep_square,w=e.half_moves,x=e.move_number;var r,o,a=A,l=Y(A);if(y[n.from]=y[n.to],y[n.from].type=n.piece,y[n.to]=null,n.flags&d.CAPTURE)y[n.to]={type:n.captured,color:l};else if(n.flags&d.EP_CAPTURE){var u;u=a===t?n.to-16:n.to+16,y[u]={type:i,color:l}}n.flags&(d.KSIDE_CASTLE|d.QSIDE_CASTLE)&&(n.flags&d.KSIDE_CASTLE?(r=n.to+1,o=n.to-1):n.flags&d.QSIDE_CASTLE&&(r=n.to-2,o=n.to+1),y[r]=y[o],y[o]=null);return n}function V(e,t){var n=K(e);if(t){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var i=r[1],o=r[2],a=r[3],l=r[4]}for(var u=Q(),s=0,c=u.length;s<c;s++){if(n===K(q(u[s]))||t&&n===K(q(u[s],!0)))return u[s];if(r&&(!i||i.toLowerCase()==u[s].piece)&&g[o]==u[s].from&&g[a]==u[s].to&&(!l||l.toLowerCase()==u[s].promotion))return u[s]}return null}function Z(e){return e>>4}function J(e){return 15&e}function X(e){var t=J(e),n=Z(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function Y(e){return e===n?t:n}function ee(e){var t=te(e);t.san=q(t,!1),t.to=X(t.to),t.from=X(t.from);var n="";for(var r in d)d[r]&t.flags&&(n+=v[r]);return t.flags=n,t}function te(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?te(e[n]):e[n];return t}function ne(e){return e.replace(/^\s+|\s+$/g,"")}function re(e){for(var t=Q({legal:!1}),n=0,r=A,i=0,o=t.length;i<o;i++){if(G(t[i]),!D(r))if(e-1>0)n+=re(e-1);else n++;z()}return n}return P(void 0===e?l:e),{WHITE:n,BLACK:t,PAWN:i,KNIGHT:"n",BISHOP:o,ROOK:"r",QUEEN:"q",KING:a,SQUARES:function(){for(var e=[],t=g.a8;t<=g.h1;t++)136&t?t+=7:e.push(X(t));return e}(),FLAGS:v,load:function(e){return P(e)},reset:function(){return _()},moves:function(e){for(var t=Q(e),n=[],r=0,i=t.length;r<i;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ee(t[r])):n.push(q(t[r],!1));return n},in_check:function(){return j()},in_checkmate:function(){return M()},in_stalemate:function(){return W()},in_draw:function(){return w>=100||W()||F()||H()},insufficient_material:function(){return F()},in_threefold_repetition:function(){return H()},game_over:function(){return w>=100||M()||W()||F()||H()},validate_fen:function(e){return R(e)},fen:function(){return N()},board:function(){for(var e=[],t=[],n=g.a8;n<=g.h1;n++)null==y[n]?t.push(null):t.push({type:y[n].type,color:y[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],i=!1;for(var o in k)r.push("["+o+' "'+k[o]+'"]'+t),i=!0;i&&S.length&&r.push(t);for(var a=[];S.length>0;)a.push(z());for(var l=[],u="";a.length>0;){var s=a.pop();S.length||"b"!==s.color?"w"===s.color&&(u.length&&l.push(u),u=x+"."):u=x+". ...",u=u+" "+q(s,!1),G(s)}if(u.length&&l.push(u),void 0!==k.Result&&l.push(k.Result),0===n)return r.join("")+l.join(" ");var c=0;for(o=0;o<l.length;o++)c+l[o].length>n&&0!==o?(" "===r[r.length-1]&&r.pop(),r.push(t),c=0):0!==o&&(r.push(" "),c++),r.push(l[o]),c+=l[o].length;return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}var i="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o=new RegExp("^(\\[((?:"+r(i)+")|.)*\\])(?:"+r(i)+"){2}"),a=o.test(e)?o.exec(e)[1]:"";_();var l=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i={},o=e.split(new RegExp(r(n))),a="",l="",u=0;u<o.length;u++)a=o[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),l=o[u].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ne(a).length>0&&(i[a]=l);return i}(a,t);for(var s in l)O([s,l[s]]);if(!("1"!==l.SetUp||"FEN"in l&&P(l.FEN,!0)))return!1;var c=e.replace(a,"").replace(new RegExp(r(i),"g")," ");c=c.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(c);)c=c.replace(f,"");var h=ne(c=(c=(c=c.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));h=h.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<h.length-1;v++){if(null==(p=V(h[v],n)))return!1;G(p)}if(p=h[h.length-1],u.indexOf(p)>-1)(function(e){for(var t in e)return!0;return!1})(k)&&void 0===k.Result&&O(["Result",p]);else{if(null==(p=V(p,n)))return!1;G(p)}return!0},header:function(){return O(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=g.a8;t<=g.h1;t++){if(0===J(t)&&(e+=" "+"87654321"[Z(t)]+" |"),null==y[t])e+=" . ";else{var r=y[t].type;e+=" "+(y[t].color===n?r.toUpperCase():r.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return A},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=V(e,n);else if("object"==typeof e)for(var i=Q(),o=0,a=i.length;o<a;o++)if(e.from===X(i[o].from)&&e.to===X(i[o].to)&&(!("promotion"in i[o])||e.promotion===i[o].promotion)){r=i[o];break}if(!r)return null;var l=ee(r);return G(r),l},undo:function(){var e=z();return e?ee(e):null},clear:function(){return T()},put:function(e,t){return $(e,t)},get:function(e){return L(e)},remove:function(e){return function(e){var t=L(e);return y[g[e]]=null,t&&t.type===a&&(b[t.color]=r),I(N()),t}(e)},perft:function(e){return re(e)},square_color:function(e){if(e in g){var t=g[e];return(Z(t)+J(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);S.length>0;)t.push(z());for(;t.length>0;){var i=t.pop();r?n.push(ee(i)):n.push(q(i)),G(i)}return n}}};function w(e,t){this.fen=e,this.notation=t,this.toString=function(){return"IllegalMoveException: "+e+" => "+t}}void 0!==E&&(E.$da5df6e5f332d0ce$export$a4d6ea685c300d39=C),"undefined"!=typeof define&&define((function(){return C}));var x=function(){"use strict";function e(n,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t(this,e),n){var o=A.parse(n.replace(/\s\s+/g," ").replace(/\n/g," "));this.moves=this.traverse(o[0],r,void 0,1,i)}else this.clear();this.setUpFen=r}return r(e,[{key:"clear",value:function(){this.moves=[]}},{key:"traverse",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=t?new E.Chess(t):new E.Chess,a=[],l=n,u=!0,s=!1,c=void 0;try{for(var f,h=e[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;if(p.notation){var v=p.notation.notation,d=o.move(v,{sloppy:i});if(!d)throw new w(o.fen(),v);l?(d.previous=l,l.next=d):d.previous=void 0,d.ply=r,this.fillMoveFromChessState(d,o),p.nag&&(d.nag=p.nag[0]),p.commentBefore&&(d.commentBefore=p.commentBefore),p.commentMove&&(d.commentMove=p.commentMove),p.commentAfter&&(d.commentAfter=p.commentAfter),d.variations=[];var g=p.variations;if(g.length>0){var m=a.length>0?a[a.length-1].fen:t,y=!0,b=!1,A=void 0;try{for(var C,x=g[Symbol.iterator]();!(y=(C=x.next()).done);y=!0){var S=C.value;d.variations.push(this.traverse(S,m,l,r,i))}}catch(e){b=!0,A=e}finally{try{y||null==x.return||x.return()}finally{if(b)throw A}}}d.variation=a,a.push(d),l=d}r++}}catch(e){s=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(s)throw c}}return a}},{key:"fillMoveFromChessState",value:function(e,t){e.fen=t.fen(),e.variations=[],t.game_over()&&(e.gameOver=!0,t.in_draw()&&(e.inDraw=!0),t.in_stalemate()&&(e.inStalemate=!0),t.insufficient_material()&&(e.insufficientMaterial=!0),t.in_threefold_repetition()&&(e.inThreefoldRepetition=!0),t.in_checkmate()&&(e.inCheckmate=!0)),t.in_check()&&(e.inCheck=!0)}},{key:"historyToMove",value:function(e){var t=[],n=e;for(t.push(n);n.previous;)t.push(n.previous),n=n.previous;return t.reverse()}},{key:"addMove",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t||this.moves.length>0&&(t=this.moves[this.moves.length-1]);var r=new E.Chess(this.setUpFen?this.setUpFen:void 0);if(t){var i=this.historyToMove(t),o=!0,a=!1,l=void 0;try{for(var u,s=i[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;r.move(c)}}catch(e){a=!0,l=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw l}}}var f=r.move(e,{sloppy:n});if(!f)throw new Error("invalid move");return this.fillMoveFromChessState(f,r),t?(f.previous=t,f.ply=t.ply+1,t.next?(t.next.variations.push([]),f.variation=t.next.variations[t.next.variations.length-1],f.variation.push(f)):(t.next=f,f.variation=t.variation,t.variation.push(f))):(f.variation=this.moves,f.ply=1,this.moves.push(f)),f}},{key:"render",value:function(){var e="",t=!0,n=!1,r=void 0;try{for(var i,o=this.moves[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){e+=i.value.san+" "}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}}]),e}(),S=function(){"use strict";function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e);var i="]"===n.trim().substr(-1)?n.length:n.lastIndexOf("]\n\n")+1,o=n.substr(0,i),a=n.substr(i),l=!!r.sloppy;this.header=new p(o),"1"===this.header.tags[f]&&this.header.tags[h]?this.history=new x(a,this.header.tags[h],l):this.history=new x(a,void 0,l)}return r(e,[{key:"render",value:function(){var e="";return e+=this.header.render(),e+="\n",e+=this.history.render()}}]),e}(),k={};Object.defineProperty(k,"__esModule",{value:!0});var T=/^\s*([prnbqkPRNBQK12345678]{1,8}(?:\/[prnbqkPRNBQK12345678]{1,8}){7})\s+(w|b)\s+([KQkqA-Ha-h]{1,4}|\-)\s+(?:(?:([a-h][36]|\-)\s+(\d{1,3})\s+(\d{1,4}))|(?:0\s+0))\s*$/,_=/[1-8]+/g,P=/\-+/g,R={1:"-",2:"--",3:"---",4:"----",5:"-----",6:"------",7:"-------",8:"--------"},N=function(){function e(e){this.original="",this.isValid=!1,this.positions="",this.ranks=[],this.turn="",this.castles="",this.enpass="",this.halfmoveClock=0,this.moveNumber=0,this.original="string"==typeof e?e:"";var t=this.original.match(T);this.isValid=!!t,t&&(this.positions=t[1],this.ranks=t[1].split("/").map((function(e){return e.replace(_,(function(e){return R[e]}))})),this.turn=t[2],this.castles=t[3],this.enpass=void 0!==t[4]?t[4]:"-",this.halfmoveClock=void 0!==t[5]?parseInt(t[5],10):0,this.moveNumber=void 0!==t[6]?parseInt(t[6],10):1,this.isValid=this.ranks.reduce((function(e,t){return e&&8===t.length}),!0))}return e.prototype.toString=function(){return this.ranks.map((function(e){return e.replace(P,(function(e){return e.length.toString()}))})).join("/")+" "+this.turn+" "+this.castles+" "+this.enpass+" "+this.halfmoveClock+" "+this.moveNumber},e.prototype.hasPiece=function(e){return this.positions.indexOf(e)>=0},e.prototype.counts=function(){for(var e={},t=0,n=this.ranks;t<n.length;t++)for(var r=0,i=n[t];r<i.length;r++){var o=i[r];"-"!==o&&(e[o]=(e[o]||0)+1)}return e},e.isFen=function(e){return"string"==typeof e&&T.test(e)},e}();k.FenParser=N,k.default=N;var O=document.getElementById("prev-js"),I=document.getElementById("play-js"),L=document.getElementById("next-js"),$=document.getElementById("stop-js"),B=document.getElementById("delay-js"),Q=i(document.getElementsByClassName("audio-input")),q={},K=0,U=new S('[Event "Match"]\n[Site "Philadelphie, USA"]\n[Date "1996.02.10"]\n[Round "1"]\n[White "Deep Blue (Computer)"]\n[Black "Garry Kasparov"]\n[Result "1-0"]\n[ECO "B22"]\n[PlyCount "73"]\n[EventDate "1996.??.??"]\n[WhiteElo ""]\n[BlackElo ""]\n\n1. e4 c5 {Garry choisi sa défense favorite contre 1.e4} 2. c3\n{L\'ordinateur évite les grandes lignes en jouant l\'Alapine.} 2... d5 3.\nexd5 Qxd5 4. d4 Nf6 5. Nf3 Bg4 6. Be2 e6 7. h3 Bh5 8. O-O Nc6 9. Be3 cxd4 10.\ncxd4 Bb4 {Un coup assez rare.} (10... Be7 {Est le coup le plus joué dans\ncette position.} 11. Nc3 Qd6) 11. a3 Ba5 12. Nc3 Qd6 13. Nb5 Qe7 14. Ne5 Bxe2\n15. Qxe2 O-O 16. Rac1 Rac8 {Les deux camps ont terminé leur\ndéveloppement et activé toutes leurs pièces. Les blancs\njouent avec un pion isolé et vont devoir être très actifs\npour justifier cette légère faiblesse.} 17. Bg5 Bb6 18. Bxf6 gxf6\n19. Nc4 Rfd8 20. Nxb6 axb6 21. Rfd1 f5 22. Qe3 {Les blancs activent leur dame et\nmenace d\'envahir l\'aile roi adverse.} 22... Qf6 23. d5 Rxd5 24. Rxd5 exd5 25. b3\nKh8 26. Qxb6 Rg8 {Pour compenser leur structure de pions ruinée, les\nnoirs tentent d\'organiser une attaque.} 27. Qc5 d4 $2 (27... f4 {garde la position\n&agrave; peu près égale.}) 28. Nd6 $1 f4 29. Nxb7 Ne5 30. Qd5 f3 31.\ng3 Nd3 32. Rc7 {Les pièces blanches se coordonnent pour attaquer la\nposition noire.} 32... Re8 $4 {L\'erreur fatale.} 33. Nd6 Re1+ 34. Kh2 Nxf2 35.\nNxf7+ Kg7 36. Ng5+ Kh6 37. Rxh7+ {C\'est la première fois qu\'un ordinateur\nbat le champion du monde en cadence classique. Un moment historique  $1} 1-0'),D=U.history.moves.map((function(t){return new(e(k))(t.fen).ranks})),j=new(e(k))("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");D.unshift(j.ranks);var M=new function(e){this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.width,this.cellWidth=this.width/8,this.cellHeight=this.height/8,this.draw=function(){this.ctx.clearRect(0,0,this.width,this.height);for(var e=0;e<64;e++){var t=Math.floor(e/8),n=e-8*t;this.ctx.strokeStyle="rgb(233, 244, 251)",this.ctx.strokeRect(n*this.cellWidth,t*this.cellHeight,this.cellWidth,this.cellHeight)}}}(document.getElementById("chessboard")),W=[];D.forEach((function(e){var t=[];e.forEach((function(e,n){i(e).forEach((function(e,r){"P"===e?t.push(new o({y:r,x:7-n},!0)):"p"===e?t.push(new o({y:r,x:7-n},!1)):"r"===e?t.push(new a({y:r,x:7-n},!1)):"R"===e?t.push(new a({y:r,x:7-n},!0)):"n"===e?t.push(new l({y:r,x:7-n},!1)):"N"===e?t.push(new l({y:r,x:7-n},!0)):"b"===e?t.push(new u({y:r,x:7-n},!1)):"B"===e?t.push(new u({y:r,x:7-n},!0)):"q"===e?t.push(new s({y:r,x:7-n},!1)):"Q"===e?t.push(new s({y:r,x:7-n},!0)):"k"===e?t.push(new c({y:r,x:7-n},!1)):"K"===e&&t.push(new c({y:r,x:7-n},!0))}))})),W.push(t)}));var F,H=U.history.moves.map((function(e){return e.flags}));function G(){M.draw(),W[K].forEach((function(e){e.draw(M)}))}L.addEventListener("click",(function(e){Z(),K=Math.min(K+1,W.length-1),G()})),O.addEventListener("click",(function(e){K=Math.max(K-1,0),G()}));var z=!1;function V(){z=!z,I.innerHTML=z?'<i class="fa fa-pause" aria-hidden="true"></i>':'<i class="fa fa-play" aria-hidden="true"></i>',z?F=window.setInterval((function(){Z(),++K>=W.length-1?V():G()}),1e3*B.value):clearInterval(F)}function Z(){var e=H[K];console.log(e),q[e]&&q[e].play()}I.addEventListener("click",V),$.addEventListener("click",(function(e){K=0,z&&V(),G()})),Q.forEach((function(e){e.addEventListener("change",(function(e){var t=e.target.id;if(e.target.files.length){var n=URL.createObjectURL(e.target.files[0]);q[t]=document.createElement("audio"),q[t].addEventListener("load",(function(){URL.revokeObjectURL(n)})),q[t].controls="true",q[t].src=n,q[t].play()}}))})),G()}();
//# sourceMappingURL=index.a199e66c.js.map
