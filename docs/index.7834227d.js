function e(e){return e&&e.__esModule?e.default:e}function t(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=this.pos.x*n+n/2,i=this.pos.y*r+r/2,l=.15*n;t.beginPath(),t.arc(o,i,l,0,2*Math.PI,!1),this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill()),t.closePath()}}function n(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=.4*n,i=.6*r,l=this.pos.x*n+.5*(n-o),s=this.pos.y*r+.5*(r-i);this.isWhite?(t.strokeStyle="rgb(0,0,0)",t.strokeRect(l,s,o,i)):(t.fillStyle="rgb(0,0,0)",t.fillRect(l,s,o,i))}}function r(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=.5*n,i=.2*n,l=.3*n,s=.6*n,a=.5*-l,u=.5*-s,c=this.pos.x*n+o,f=this.pos.y*r+o;t.translate(c,f),this.isWhite||t.scale(-1,1),t.beginPath(),t.moveTo(a,u),t.lineTo(a+o,u),t.lineTo(a+o,u+i),t.lineTo(a+l,u+i),t.lineTo(a+l,u+s),t.lineTo(a,u+s),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function o(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=.4*n,i=.6*r,l=this.pos.x*n+.5*n,s=this.pos.y*r+.5*(r-i);t.beginPath(),t.moveTo(l,s),t.lineTo(l+.5*o,s+i),t.lineTo(l-.5*o,s+i),t.closePath(),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function i(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=.6*n,i=.1*n,l=.1*r,s=.6*r,a=.5*(n-l)-.5*n,u=.5*(r-s)-.5*r,c=this.pos.x*n+.5*n,f=this.pos.y*r+.5*r;t.translate(c,f),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(a,u),t.lineTo(a+l,u),t.lineTo(a+l,u+.5*(s-i)),t.lineTo(a+l+.5*(o-l),u+.5*(s-i)),t.lineTo(a+l+.5*(o-l),u+.5*(s+i)),t.lineTo(a+l,u+.5*(s+i)),t.lineTo(a+l,u+s),t.lineTo(a,u+s),t.lineTo(a,u+.5*(s+i)),t.lineTo(a-.5*(o-l),u+.5*(s+i)),t.lineTo(a-.5*(o-l),u+.5*(s-i)),t.lineTo(a,u+.5*(s-i)),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}function l(e,t){this.cnPos=e,this.pos=e,this.isWhite=t,this.draw=function(e){const t=e.ctx,n=e.cellWidth,r=e.cellHeight,o=.6*n,i=.2*n,l=.2*r,s=.6*r,a=.5*(n-l)-.5*n,u=.5*(r-s)-.5*r,c=this.pos.x*n+.5*n,f=this.pos.y*r+.5*r;t.translate(c,f),t.beginPath(),t.moveTo(a,u),t.lineTo(a+l,u),t.lineTo(a+l,u+.5*(s-i)),t.lineTo(a+l+.5*(o-l),u+.5*(s-i)),t.lineTo(a+l+.5*(o-l),u+.5*(s+i)),t.lineTo(a+l,u+.5*(s+i)),t.lineTo(a+l,u+s),t.lineTo(a,u+s),t.lineTo(a,u+.5*(s+i)),t.lineTo(a-.5*(o-l),u+.5*(s+i)),t.lineTo(a-.5*(o-l),u+.5*(s-i)),t.lineTo(a,u+.5*(s-i)),t.closePath(),t.setTransform(1,0,0,1,0,0),t.strokeStyle="rgb(0, 0, 0)",this.isWhite?(t.strokeStyle="rgb(0, 0, 0)",t.stroke()):(t.fillStyle="rgb(0, 0, 0)",t.fill())}}const s="SetUp",a="FEN";class u{clear(){this.tags={}}render(){let e="";for(const t in this.tags)e+=`[${t} "${this.tags[t]}"]\n`;return e}constructor(e=""){this.clear();const t=e.match(/\[([^\]]+)]/g);if(t&&t.length>0)for(let e=0;e<t.length;e++){let n=t[e].match(/\[(\w+)\s+"([^"]+)"/);n&&(this.tags[n[1]]=n[2])}}}function c(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,c)}function f(e,t){t=void 0!==t?t:{};var n,r={},o={pgn:Ie},i=Ie,l=Se("1:0",!1),s=Se("0:1",!1),a=Se("1-0",!1),u=Se("0-1",!1),f="1/2-1/2",h=Se("1/2-1/2",!1),p=Se("*",!1),v=/^[^}]/,d=Te(["}"],!0,!1),g=Se("{",!1),m=Se("}",!1),b=Se("(",!1),y=Se(")",!1),A=".",E=Se(".",!1),C=_e("integer"),x=/^[0-9]/,w=Te([["0","9"]],!1,!1),S=function(e){return parseInt(e.join(""),10)},T=Se(" ",!1),_="O-O-O",k=Se("O-O-O",!1),P=Se("O-O",!1),R="+-",N=Se("+-",!1),I=Se("+",!1),O=function(e){return e[1]},$=Se("$$$",!1),L=Se("#",!1),B=Se("=",!1),Q=Se("$",!1),q="!!",K=Se("!!",!1),U="??",D=Se("??",!1),M="!?",W=Se("!?",!1),j="?!",F=Se("?!",!1),H=Se("!",!1),G=Se("?",!1),z=Se("‼",!1),V=Se("⁇",!1),Z=Se("⁉",!1),J=Se("⁈",!1),X=Se("□",!1),Y=Se("∞",!1),ee=Se("⩲",!1),te=Se("⩱",!1),ne=Se("±",!1),re=Se("∓",!1),oe="-+",ie=Se("-+",!1),le=Se("⨀",!1),se=Se("⟳",!1),ae=Se("→",!1),ue=Se("↑",!1),ce=Se("⇆",!1),fe=Se("D",!1),he=/^[RNBQKP]/,pe=Te(["R","N","B","Q","K","P"],!1,!1),ve=/^[a-h]/,de=Te([["a","h"]],!1,!1),ge=/^[1-8]/,me=Te([["1","8"]],!1,!1),be=Se("x",!1),ye=Se("-",!1),Ae=0,Ee=[{line:1,column:1}],Ce=0,xe=[],we=0;if("startRule"in t){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=o[t.startRule]}function Se(e,t){return{type:"literal",text:e,ignoreCase:t}}function Te(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function _e(e){return{type:"other",description:e}}function ke(t){var n,r=Ee[t];if(r)return r;for(n=t-1;!Ee[n];)n--;for(r={line:(r=Ee[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Ee[t]=r,r}function Pe(e,t){var n=ke(e),r=ke(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function Re(e){Ae<Ce||(Ae>Ce&&(Ce=Ae,xe=[]),xe.push(e))}function Ne(e,t,n){return new c(c.buildMessage(e,t),e,t,n)}function Ie(){var e,t,n,o,i;return e=Ae,t=function(){var e,t;e=Ae,(t=$e())!==r&&(e,t=t);return e=t}(),t!==r?((n=Le())===r&&(n=null),n!==r?(e,o=t,(i=n||[]).unshift(o),e=t=i):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Ae,(t=Oe())!==r?((n=$e())===r&&(n=null),n!==r?(e,t=function(e,t){var n=t||[];return n.unshift(e),n}(t,n),e=t):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Ae,(t=We())===r&&(t=null),t!==r&&(e,t=[[]]),e=t)),e}function Oe(){var e,t;return e=Ae,(t=Le())!==r&&(e,t=t),e=t}function $e(){var t,n,o,i,l,s,a,u,c,f,h,p,v,d,g,m,b,y,C,x,w,S,T,_;return t=Ae,(n=We())===r&&(n=null),n!==r?((o=Qe())===r&&(o=null),o!==r?((i=We())===r&&(i=null),i!==r?(l=function(){var t,n,o;t=Ae,(n=Me())!==r?(46===e.charCodeAt(Ae)?(o=A,Ae++):(o=r,0===we&&Re(E)),o===r&&(o=null),o!==r?(t,t=n=n):(Ae=t,t=r)):(Ae=t,t=r);return t}(),l===r&&(l=null),l!==r?((s=We())===r&&(s=null),s!==r?((a=Qe())===r&&(a=null),a!==r?((u=We())===r&&(u=null),u!==r&&(c=je())!==r?((f=We())===r&&(f=null),f!==r?((h=Ge())===r&&(h=null),h!==r?((p=We())===r&&(p=null),p!==r?((v=Qe())===r&&(v=null),v!==r?((d=We())===r&&(d=null),d!==r?((g=qe())===r&&(g=null),g!==r?((m=Le())===r&&(m=null),m!==r?(t,b=o,y=a,C=c,x=h,w=v,S=g,T=m||[],(_={turn:"w"}).moveNumber=l,_.notation=C,_.commentBefore=y,_.commentAfter=w,_.commentMove=b,_.variations=S||[],_.nag=x||null,T.unshift(_),t=n=T):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Be()),t}function Le(){var e,t,n,o,i,l,s,a,u,c,f,h,p,v,d,g,m,b,y,A,E,C,x;return e=Ae,(t=We())===r&&(t=null),t!==r?((n=Qe())===r&&(n=null),n!==r?((o=We())===r&&(o=null),o!==r?((i=Ve())===r&&(i=null),i!==r?((l=We())===r&&(l=null),l!==r?((s=Qe())===r&&(s=null),s!==r?((a=We())===r&&(a=null),a!==r&&(u=je())!==r?((c=We())===r&&(c=null),c!==r?((f=Ge())===r&&(f=null),f!==r?((h=We())===r&&(h=null),h!==r?((p=Qe())===r&&(p=null),p!==r?((v=We())===r&&(v=null),v!==r?((d=Ke())===r&&(d=null),d!==r?((g=$e())===r&&(g=null),g!==r?(e,m=s,b=u,y=f,A=p,E=d,C=g||[],(x={turn:"b"}).moveNumber=i,x.notation=b,x.commentBefore=m,x.commentAfter=A,x.variations=E||[],C.unshift(x),x.nag=y||null,e=t=C):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e===r&&(e=Be()),e}function Be(){var t,n;return t=Ae,"1:0"===e.substr(Ae,3)?(n="1:0",Ae+=3):(n=r,0===we&&Re(l)),n!==r&&(t,n=["1:0"]),(t=n)===r&&(t=Ae,"0:1"===e.substr(Ae,3)?(n="0:1",Ae+=3):(n=r,0===we&&Re(s)),n!==r&&(t,n=["0:1"]),(t=n)===r&&(t=Ae,"1-0"===e.substr(Ae,3)?(n="1-0",Ae+=3):(n=r,0===we&&Re(a)),n!==r&&(t,n=["1-0"]),(t=n)===r&&(t=Ae,"0-1"===e.substr(Ae,3)?(n="0-1",Ae+=3):(n=r,0===we&&Re(u)),n!==r&&(t,n=["0-1"]),(t=n)===r&&(t=Ae,e.substr(Ae,7)===f?(n=f,Ae+=7):(n=r,0===we&&Re(h)),n!==r&&(t,n=["1/2-1/2"]),(t=n)===r&&(t=Ae,42===e.charCodeAt(Ae)?(n="*",Ae++):(n=r,0===we&&Re(p)),n!==r&&(t,n=["*"]),t=n))))),t}function Qe(){var t,n,o,i;if(t=Ae,n=function(){var t;123===e.charCodeAt(Ae)?(t="{",Ae++):(t=r,0===we&&Re(g));return t}(),n!==r){for(o=[],v.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=r,0===we&&Re(d));i!==r;)o.push(i),v.test(e.charAt(Ae))?(i=e.charAt(Ae),Ae++):(i=r,0===we&&Re(d));o!==r?(i=function(){var t;125===e.charCodeAt(Ae)?(t="}",Ae++):(t=r,0===we&&Re(m));return t}(),i!==r?(t,t=n=o.join("").trim()):(Ae=t,t=r)):(Ae=t,t=r)}else Ae=t,t=r;return t}function qe(){var e,t,n,o,i,l,s,a;return e=Ae,Ue()!==r&&(t=$e())!==r&&De()!==r?((n=We())===r&&(n=null),n!==r?((o=qe())===r&&(o=null),o!==r?((i=We())===r&&(i=null),i!==r?((l=Ve())===r&&(l=null),l!==r?(e,s=t,(a=o||[]).unshift(s),e=a):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e}function Ke(){var e,t,n,o,i,l;return e=Ae,Ue()!==r&&(t=Oe())!==r&&De()!==r?((n=We())===r&&(n=null),n!==r?((o=Ke())===r&&(o=null),o!==r?(e,i=t,(l=o||[]).unshift(i),e=l):(Ae=e,e=r)):(Ae=e,e=r)):(Ae=e,e=r),e}function Ue(){var t;return 40===e.charCodeAt(Ae)?(t="(",Ae++):(t=r,0===we&&Re(b)),t}function De(){var t;return 41===e.charCodeAt(Ae)?(t=")",Ae++):(t=r,0===we&&Re(y)),t}function Me(){var t,n,o;if(we++,t=Ae,n=[],x.test(e.charAt(Ae))?(o=e.charAt(Ae),Ae++):(o=r,0===we&&Re(w)),o!==r)for(;o!==r;)n.push(o),x.test(e.charAt(Ae))?(o=e.charAt(Ae),Ae++):(o=r,0===we&&Re(w));else n=r;return n!==r&&(t,n=S(n)),we--,(t=n)===r&&(n=r,0===we&&Re(C)),t}function We(){var t,n,o;if(t=Ae,n=[],32===e.charCodeAt(Ae)?(o=" ",Ae++):(o=r,0===we&&Re(T)),o!==r)for(;o!==r;)n.push(o),32===e.charCodeAt(Ae)?(o=" ",Ae++):(o=r,0===we&&Re(T));else n=r;return n!==r&&(t,n=""),t=n}function je(){var t,n,o,i,l,s,a,u,c,f,h,p,v,d,g,m,b;return t=Ae,(n=Ze())===r&&(n=null),n!==r?(o=Ae,we++,i=function(){var e,t,n,o,i;e=Ae,(t=ze())!==r?((n=Ye())===r&&(n=null),n!==r&&(o=Je())!==r&&(i=Xe())!==r?e=t=[t,n,o,i]:(Ae=e,e=r)):(Ae=e,e=r);return e}(),we--,i!==r?(Ae=o,o=void 0):o=r,o!==r&&(i=ze())!==r?((l=Ye())===r&&(l=null),l!==r&&(s=Je())!==r&&(a=Xe())!==r?((u=He())===r&&(u=null),u!==r?((c=Fe())===r&&(c=null),c!==r?(t,h=i,p=l,v=s,d=a,g=u,m=c,(b={}).fig=(f=n)||null,b.disc=h||null,b.strike=p||null,b.col=v,b.row=d,b.check=m||null,b.promotion=g,b.notation=(f||"")+(h||"")+(p||"")+v+d+(g||"")+(m||""),t=n=b):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,(n=Ze())===r&&(n=null),n!==r&&(o=Je())!==r&&(i=Xe())!==r?(l=function(){var t;120===e.charCodeAt(Ae)?(t="x",Ae++):(t=r,0===we&&Re(be));t===r&&(45===e.charCodeAt(Ae)?(t="-",Ae++):(t=r,0===we&&Re(ye)));return t}(),l===r&&(l=null),l!==r&&(s=Je())!==r&&(a=Xe())!==r?((u=He())===r&&(u=null),u!==r?((c=Fe())===r&&(c=null),c!==r?(t,n=function(e,t,n,r,o,i,l,s){var a={};return a.fig=e||null,a.strike="x"==r?r:null,a.col=o,a.row=i,a.check=s||null,a.notation=(e&&"P"!==e?e:"")+t+n+("x"==r?r:"-")+o+i+(l||"")+(s||""),a.promotion=l,a}(n,o,i,l,s,a,u,c),t=n):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,(n=Ze())===r&&(n=null),n!==r?((o=Ye())===r&&(o=null),o!==r&&(i=Je())!==r&&(l=Xe())!==r?((s=He())===r&&(s=null),s!==r?((a=Fe())===r&&(a=null),a!==r?(t,n=function(e,t,n,r,o,i){var l={};return l.fig=e||null,l.strike=t||null,l.col=n,l.row=r,l.check=i||null,l.notation=(e||"")+(t||"")+n+r+(o||"")+(i||""),l.promotion=o,l}(n,o,i,l,s,a),t=n):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,e.substr(Ae,5)===_?(n=_,Ae+=5):(n=r,0===we&&Re(k)),n!==r?((o=Fe())===r&&(o=null),o!==r?(t,n=function(e){var t={};return t.notation="O-O-O"+(e||""),t.check=e||null,t}(o),t=n):(Ae=t,t=r)):(Ae=t,t=r),t===r&&(t=Ae,"O-O"===e.substr(Ae,3)?(n="O-O",Ae+=3):(n=r,0===we&&Re(P)),n!==r?((o=Fe())===r&&(o=null),o!==r?(t,n=function(e){var t={};return t.notation="O-O"+(e||""),t.check=e||null,t}(o),t=n):(Ae=t,t=r)):(Ae=t,t=r))))),t}function Fe(){var t,n,o,i;return t=Ae,n=Ae,o=Ae,we++,e.substr(Ae,2)===R?(i=R,Ae+=2):(i=r,0===we&&Re(N)),we--,i===r?o=void 0:(Ae=o,o=r),o!==r?(43===e.charCodeAt(Ae)?(i="+",Ae++):(i=r,0===we&&Re(I)),i!==r?n=o=[o,i]:(Ae=n,n=r)):(Ae=n,n=r),n!==r&&(t,n=O(n)),(t=n)===r&&(t=Ae,n=Ae,o=Ae,we++,"$$$"===e.substr(Ae,3)?(i="$$$",Ae+=3):(i=r,0===we&&Re($)),we--,i===r?o=void 0:(Ae=o,o=r),o!==r?(35===e.charCodeAt(Ae)?(i="#",Ae++):(i=r,0===we&&Re(L)),i!==r?n=o=[o,i]:(Ae=n,n=r)):(Ae=n,n=r),n!==r&&(t,n=O(n)),t=n),t}function He(){var t,n,o;return t=Ae,61===e.charCodeAt(Ae)?(n="=",Ae++):(n=r,0===we&&Re(B)),n!==r&&(o=Ze())!==r?(t,t=n="="+o):(Ae=t,t=r),t}function Ge(){var t,n,o,i,l,s;return t=Ae,n=function(){var t,n,o;t=Ae,36===e.charCodeAt(Ae)?(n="$",Ae++):(n=r,0===we&&Re(Q));n!==r&&(o=Me())!==r?(t,t=n="$"+o):(Ae=t,t=r);t===r&&(t=Ae,e.substr(Ae,2)===q?(n=q,Ae+=2):(n=r,0===we&&Re(K)),n!==r&&(t,n="$3"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===U?(n=U,Ae+=2):(n=r,0===we&&Re(D)),n!==r&&(t,n="$4"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===M?(n=M,Ae+=2):(n=r,0===we&&Re(W)),n!==r&&(t,n="$5"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===j?(n=j,Ae+=2):(n=r,0===we&&Re(F)),n!==r&&(t,n="$6"),(t=n)===r&&(t=Ae,33===e.charCodeAt(Ae)?(n="!",Ae++):(n=r,0===we&&Re(H)),n!==r&&(t,n="$1"),(t=n)===r&&(t=Ae,63===e.charCodeAt(Ae)?(n="?",Ae++):(n=r,0===we&&Re(G)),n!==r&&(t,n="$2"),(t=n)===r&&(t=Ae,8252===e.charCodeAt(Ae)?(n="‼",Ae++):(n=r,0===we&&Re(z)),n!==r&&(t,n="$3"),(t=n)===r&&(t=Ae,8263===e.charCodeAt(Ae)?(n="⁇",Ae++):(n=r,0===we&&Re(V)),n!==r&&(t,n="$4"),(t=n)===r&&(t=Ae,8265===e.charCodeAt(Ae)?(n="⁉",Ae++):(n=r,0===we&&Re(Z)),n!==r&&(t,n="$5"),(t=n)===r&&(t=Ae,8264===e.charCodeAt(Ae)?(n="⁈",Ae++):(n=r,0===we&&Re(J)),n!==r&&(t,n="$6"),(t=n)===r&&(t=Ae,9633===e.charCodeAt(Ae)?(n="□",Ae++):(n=r,0===we&&Re(X)),n!==r&&(t,n="$7"),(t=n)===r&&(t=Ae,61===e.charCodeAt(Ae)?(n="=",Ae++):(n=r,0===we&&Re(B)),n!==r&&(t,n="$10"),(t=n)===r&&(t=Ae,8734===e.charCodeAt(Ae)?(n="∞",Ae++):(n=r,0===we&&Re(Y)),n!==r&&(t,n="$13"),(t=n)===r&&(t=Ae,10866===e.charCodeAt(Ae)?(n="⩲",Ae++):(n=r,0===we&&Re(ee)),n!==r&&(t,n="$14"),(t=n)===r&&(t=Ae,10865===e.charCodeAt(Ae)?(n="⩱",Ae++):(n=r,0===we&&Re(te)),n!==r&&(t,n="$15"),(t=n)===r&&(t=Ae,177===e.charCodeAt(Ae)?(n="±",Ae++):(n=r,0===we&&Re(ne)),n!==r&&(t,n="$16"),(t=n)===r&&(t=Ae,8723===e.charCodeAt(Ae)?(n="∓",Ae++):(n=r,0===we&&Re(re)),n!==r&&(t,n="$17"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===R?(n=R,Ae+=2):(n=r,0===we&&Re(N)),n!==r&&(t,n="$18"),(t=n)===r&&(t=Ae,e.substr(Ae,2)===oe?(n=oe,Ae+=2):(n=r,0===we&&Re(ie)),n!==r&&(t,n="$19"),(t=n)===r&&(t=Ae,10752===e.charCodeAt(Ae)?(n="⨀",Ae++):(n=r,0===we&&Re(le)),n!==r&&(t,n="$22"),(t=n)===r&&(t=Ae,10227===e.charCodeAt(Ae)?(n="⟳",Ae++):(n=r,0===we&&Re(se)),n!==r&&(t,n="$32"),(t=n)===r&&(t=Ae,8594===e.charCodeAt(Ae)?(n="→",Ae++):(n=r,0===we&&Re(ae)),n!==r&&(t,n="$36"),(t=n)===r&&(t=Ae,8593===e.charCodeAt(Ae)?(n="↑",Ae++):(n=r,0===we&&Re(ue)),n!==r&&(t,n="$40"),(t=n)===r&&(t=Ae,8646===e.charCodeAt(Ae)?(n="⇆",Ae++):(n=r,0===we&&Re(ce)),n!==r&&(t,n="$132"),(t=n)===r&&(t=Ae,68===e.charCodeAt(Ae)?(n="D",Ae++):(n=r,0===we&&Re(fe)),n!==r&&(t,n="$220"),t=n)))))))))))))))))))))))));return t}(),n!==r?((o=We())===r&&(o=null),o!==r?((i=Ge())===r&&(i=null),i!==r?(t,l=n,(s=i||[]).unshift(l),t=n=s):(Ae=t,t=r)):(Ae=t,t=r)):(Ae=t,t=r),t}function ze(){var e;return(e=Je())===r&&(e=Xe()),e}function Ve(){var t,n,o,i;if(t=Ae,(n=Me())!==r){if(o=[],46===e.charCodeAt(Ae)?(i=A,Ae++):(i=r,0===we&&Re(E)),i!==r)for(;i!==r;)o.push(i),46===e.charCodeAt(Ae)?(i=A,Ae++):(i=r,0===we&&Re(E));else o=r;o!==r?(t,t=n=n):(Ae=t,t=r)}else Ae=t,t=r;return t}function Ze(){var t;return he.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===we&&Re(pe)),t}function Je(){var t;return ve.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===we&&Re(de)),t}function Xe(){var t;return ge.test(e.charAt(Ae))?(t=e.charAt(Ae),Ae++):(t=r,0===we&&Re(me)),t}function Ye(){var t;return 120===e.charCodeAt(Ae)?(t="x",Ae++):(t=r,0===we&&Re(be)),t}if((n=i())!==r&&Ae===e.length)return n;throw n!==r&&Ae<e.length&&Re({type:"end"}),Ne(xe,Ce<e.length?e.charAt(Ce):null,Ce<e.length?Pe(Ce,Ce+1):Pe(Ce,Ce))}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(c,Error),c.buildMessage=function(e,t){var n,r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?l(e.parts[t][0])+"-"+l(e.parts[t][1]):l(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function o(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+o(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+o(e)}))}function l(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+o(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+o(e)}))}return"Expected "+function(e){var t,n,o,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(o=e[t],r[o.type](o));if(i.sort(),i.length>0){for(t=1,n=1;t<i.length;t++)i[t-1]!==i[t]&&(i[n]=i[t],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+(((n=t)?'"'+i(n)+'"':"end of input")+" found.")};var h,p,v,d,g={};h=g,p="Chess",v=function(){return m},d=function(e){return m=e},Object.defineProperty(h,p,{get:v,set:d,enumerable:!0,configurable:!0});
/* @license
 * Copyright (c) 2018, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var m=function(e){var t="b",n="w",r=-1,o="p",i="b",l="k",s="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",a=["1-0","0-1","1/2-1/2","*"],u={b:[16,32,17,15],w:[-16,-32,-17,-15]},c={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},f=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],h=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:0,n:1,b:2,r:3,q:4,k:5},v={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},d={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},g={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},m={w:[{square:g.a1,flag:d.QSIDE_CASTLE},{square:g.h1,flag:d.KSIDE_CASTLE}],b:[{square:g.a8,flag:d.QSIDE_CASTLE},{square:g.h8,flag:d.KSIDE_CASTLE}]},b=new Array(128),y={w:r,b:r},A=n,E={w:0,b:0},C=r,x=0,w=1,S=[],T={};function _(e){void 0===e&&(e=!1),b=new Array(128),y={w:r,b:r},A=n,E={w:0,b:0},C=r,x=0,w=1,S=[],e||(T={}),O(N())}function k(){P(s)}function P(e,o){void 0===o&&(o=!1);var i=e.split(/\s+/),l=i[0],s=0;if(!R(e).valid)return!1;_(o);for(var a=0;a<l.length;a++){var u=l.charAt(a);if("/"===u)s+=8;else if(-1!=="0123456789".indexOf(u))s+=parseInt(u,10);else{var c=u<"a"?n:t;L({type:u.toLowerCase(),color:c},X(s)),s++}}return A=i[1],i[2].indexOf("K")>-1&&(E.w|=d.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(E.w|=d.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(E.b|=d.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(E.b|=d.QSIDE_CASTLE),C="-"===i[3]?r:g[i[3]],x=parseInt(i[4],10),w=parseInt(i[5],10),O(N()),!0}function R(e){var t="No errors.",n="FEN string must contain six space-delimited fields.",r="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",l="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",a="1st field (piece positions) does not contain 8 '/'-delimited rows.",u="1st field (piece positions) is invalid [consecutive numbers].",c="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",h="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:n};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:r};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:l};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:s};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:a};for(var d=0;d<v.length;d++){for(var g=0,m=!1,b=0;b<v[d].length;b++)if(isNaN(v[d][b])){if(!/^[prnbqkPRNBQK]$/.test(v[d][b]))return{valid:!1,error_number:9,error:c};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:u};g+=parseInt(v[d][b],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:h}:{valid:!0,error_number:0,error:t}}function N(){for(var e=0,t="",o=g.a8;o<=g.h1;o++){if(null==b[o])e++;else{e>0&&(t+=e,e=0);var i=b[o].color,l=b[o].type;t+=i===n?l.toUpperCase():l.toLowerCase()}o+1&136&&(e>0&&(t+=e),o!==g.h1&&(t+="/"),e=0,o+=8)}var s="";E.w&d.KSIDE_CASTLE&&(s+="K"),E.w&d.QSIDE_CASTLE&&(s+="Q"),E.b&d.KSIDE_CASTLE&&(s+="k"),E.b&d.QSIDE_CASTLE&&(s+="q"),s=s||"-";var a=C===r?"-":X(C);return[t,A,s,a,x,w].join(" ")}function I(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(T[e[t]]=e[t+1]);return T}function O(e){S.length>0||(e!==s?(T.SetUp="1",T.FEN=e):(delete T.SetUp,delete T.FEN))}function $(e){var t=b[g[e]];return t?{type:t.type,color:t.color}:null}function L(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in g))return!1;var n=g[t];return(e.type!=l||y[e.color]==r||y[e.color]==n)&&(b[n]={type:e.type,color:e.color},e.type===l&&(y[e.color]=n),O(N()),!0)}function B(e,t,n,r,i){var l={color:A,from:t,to:n,flags:r,piece:e[t].type};return i&&(l.flags|=d.PROMOTION,l.promotion=i),e[n]?l.captured=e[n].type:r&d.EP_CAPTURE&&(l.captured=o),l}function Q(e){function t(e,t,n,r,l){if(e[n].type!==o||0!==Z(r)&&7!==Z(r))t.push(B(e,n,r,l));else for(var s=["q","r",i,"n"],a=0,u=s.length;a<u;a++)t.push(B(e,n,r,l,s[a]))}var n=[],r=A,l=Y(r),s={b:1,w:6},a=g.a8,f=g.h1,h=!1,p=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in g))return[];a=f=g[e.square],h=!0}for(var v=a;v<=f;v++)if(136&v)v+=7;else{var m=b[v];if(null!=m&&m.color===r)if(m.type===o){var x=v+u[r][0];if(null==b[x]){t(b,n,v,x,d.NORMAL);x=v+u[r][1];s[r]===Z(v)&&null==b[x]&&t(b,n,v,x,d.BIG_PAWN)}for(w=2;w<4;w++){136&(x=v+u[r][w])||(null!=b[x]&&b[x].color===l?t(b,n,v,x,d.CAPTURE):x===C&&t(b,n,v,C,d.EP_CAPTURE))}}else for(var w=0,S=c[m.type].length;w<S;w++){var T=c[m.type][w];for(x=v;!(136&(x+=T));){if(null!=b[x]){if(b[x].color===r)break;t(b,n,v,x,d.CAPTURE);break}if(t(b,n,v,x,d.NORMAL),"n"===m.type||"k"===m.type)break}}}if(!h||f===y[r]){if(E[r]&d.KSIDE_CASTLE){var _=(k=y[r])+2;null!=b[k+1]||null!=b[_]||U(l,y[r])||U(l,k+1)||U(l,_)||t(b,n,y[r],_,d.KSIDE_CASTLE)}if(E[r]&d.QSIDE_CASTLE){var k;_=(k=y[r])-2;null!=b[k-1]||null!=b[k-2]||null!=b[k-3]||U(l,y[r])||U(l,k-1)||U(l,_)||t(b,n,y[r],_,d.QSIDE_CASTLE)}}if(!p)return n;var P=[];for(v=0,S=n.length;v<S;v++)G(n[v]),D(r)||P.push(n[v]),z();return P}function q(e,t){var n="";if(e.flags&d.KSIDE_CASTLE)n="O-O";else if(e.flags&d.QSIDE_CASTLE)n="O-O-O";else{var r=function(e,t){for(var n=Q({legal:!t}),r=e.from,o=e.to,i=e.piece,l=0,s=0,a=0,u=0,c=n.length;u<c;u++){var f=n[u].from,h=n[u].to;i===n[u].piece&&r!==f&&o===h&&(l++,Z(r)===Z(f)&&s++,J(r)===J(f)&&a++)}if(l>0)return s>0&&a>0?X(r):a>0?X(r).charAt(1):X(r).charAt(0);return""}(e,t);e.piece!==o&&(n+=e.piece.toUpperCase()+r),e.flags&(d.CAPTURE|d.EP_CAPTURE)&&(e.piece===o&&(n+=X(e.from)[0]),n+="x"),n+=X(e.to),e.flags&d.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return G(e),M()&&(W()?n+="#":n+="+"),z(),n}function K(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function U(e,r){for(var i=g.a8;i<=g.h1;i++)if(136&i)i+=7;else if(null!=b[i]&&b[i].color===e){var l=b[i],s=i-r,a=s+119;if(f[a]&1<<p[l.type]){if(l.type===o){if(s>0){if(l.color===n)return!0}else if(l.color===t)return!0;continue}if("n"===l.type||"k"===l.type)return!0;for(var u=h[a],c=i+u,v=!1;c!==r;){if(null!=b[c]){v=!0;break}c+=u}if(!v)return!0}}return!1}function D(e){return U(Y(e),y[e])}function M(){return D(A)}function W(){return M()&&0===Q().length}function j(){return!M()&&0===Q().length}function F(){for(var e={},t=[],n=0,r=0,o=g.a8;o<=g.h1;o++)if(r=(r+1)%2,136&o)o+=7;else{var l=b[o];l&&(e[l.type]=l.type in e?e[l.type]+1:1,l.type===i&&t.push(r),n++)}if(2===n)return!0;if(3===n&&(1===e.b||1===e.n))return!0;if(n===e.b+2){var s=0,a=t.length;for(o=0;o<a;o++)s+=t[o];if(0===s||s===a)return!0}return!1}function H(){for(var e=[],t={},n=!1;;){var r=z();if(!r)break;e.push(r)}for(;;){var o=N().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;G(e.pop())}return n}function G(e){var n=A,i=Y(n);if(function(e){S.push({move:e,kings:{b:y.b,w:y.w},turn:A,castling:{b:E.b,w:E.w},ep_square:C,half_moves:x,move_number:w})}(e),b[e.to]=b[e.from],b[e.from]=null,e.flags&d.EP_CAPTURE&&(A===t?b[e.to-16]=null:b[e.to+16]=null),e.flags&d.PROMOTION&&(b[e.to]={type:e.promotion,color:n}),b[e.to].type===l){if(y[b[e.to].color]=e.to,e.flags&d.KSIDE_CASTLE){var s=e.to-1,a=e.to+1;b[s]=b[a],b[a]=null}else if(e.flags&d.QSIDE_CASTLE){s=e.to+1,a=e.to-2;b[s]=b[a],b[a]=null}E[n]=""}if(E[n])for(var u=0,c=m[n].length;u<c;u++)if(e.from===m[n][u].square&&E[n]&m[n][u].flag){E[n]^=m[n][u].flag;break}if(E[i])for(u=0,c=m[i].length;u<c;u++)if(e.to===m[i][u].square&&E[i]&m[i][u].flag){E[i]^=m[i][u].flag;break}C=e.flags&d.BIG_PAWN?"b"===A?e.to-16:e.to+16:r,e.piece===o||e.flags&(d.CAPTURE|d.EP_CAPTURE)?x=0:x++,A===t&&w++,A=Y(A)}function z(){var e=S.pop();if(null==e)return null;var n=e.move;y=e.kings,A=e.turn,E=e.castling,C=e.ep_square,x=e.half_moves,w=e.move_number;var r,i,l=A,s=Y(A);if(b[n.from]=b[n.to],b[n.from].type=n.piece,b[n.to]=null,n.flags&d.CAPTURE)b[n.to]={type:n.captured,color:s};else if(n.flags&d.EP_CAPTURE){var a;a=l===t?n.to-16:n.to+16,b[a]={type:o,color:s}}n.flags&(d.KSIDE_CASTLE|d.QSIDE_CASTLE)&&(n.flags&d.KSIDE_CASTLE?(r=n.to+1,i=n.to-1):n.flags&d.QSIDE_CASTLE&&(r=n.to-2,i=n.to+1),b[r]=b[i],b[i]=null);return n}function V(e,t){var n=K(e);if(t){var r=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(r)var o=r[1],i=r[2],l=r[3],s=r[4]}for(var a=Q(),u=0,c=a.length;u<c;u++){if(n===K(q(a[u]))||t&&n===K(q(a[u],!0)))return a[u];if(r&&(!o||o.toLowerCase()==a[u].piece)&&g[i]==a[u].from&&g[l]==a[u].to&&(!s||s.toLowerCase()==a[u].promotion))return a[u]}return null}function Z(e){return e>>4}function J(e){return 15&e}function X(e){var t=J(e),n=Z(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function Y(e){return e===n?t:n}function ee(e){var t=te(e);t.san=q(t,!1),t.to=X(t.to),t.from=X(t.from);var n="";for(var r in d)d[r]&t.flags&&(n+=v[r]);return t.flags=n,t}function te(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?te(e[n]):e[n];return t}function ne(e){return e.replace(/^\s+|\s+$/g,"")}function re(e){for(var t=Q({legal:!1}),n=0,r=A,o=0,i=t.length;o<i;o++){if(G(t[o]),!D(r))if(e-1>0)n+=re(e-1);else n++;z()}return n}return P(void 0===e?s:e),{WHITE:n,BLACK:t,PAWN:o,KNIGHT:"n",BISHOP:i,ROOK:"r",QUEEN:"q",KING:l,SQUARES:function(){for(var e=[],t=g.a8;t<=g.h1;t++)136&t?t+=7:e.push(X(t));return e}(),FLAGS:v,load:function(e){return P(e)},reset:function(){return k()},moves:function(e){for(var t=Q(e),n=[],r=0,o=t.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ee(t[r])):n.push(q(t[r],!1));return n},in_check:function(){return M()},in_checkmate:function(){return W()},in_stalemate:function(){return j()},in_draw:function(){return x>=100||j()||F()||H()},insufficient_material:function(){return F()},in_threefold_repetition:function(){return H()},game_over:function(){return x>=100||W()||j()||F()||H()},validate_fen:function(e){return R(e)},fen:function(){return N()},board:function(){for(var e=[],t=[],n=g.a8;n<=g.h1;n++)null==b[n]?t.push(null):t.push({type:b[n].type,color:b[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in T)r.push("["+i+' "'+T[i]+'"]'+t),o=!0;o&&S.length&&r.push(t);for(var l=[];S.length>0;)l.push(z());for(var s=[],a="";l.length>0;){var u=l.pop();S.length||"b"!==u.color?"w"===u.color&&(a.length&&s.push(a),a=w+"."):a=w+". ...",a=a+" "+q(u,!1),G(u)}if(a.length&&s.push(a),void 0!==T.Result&&s.push(T.Result),0===n)return r.join("")+s.join(" ");var c=0;for(i=0;i<s.length;i++)c+s[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),c=0):0!==i&&(r.push(" "),c++),r.push(s[i]),c+=s[i].length;return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+r(o)+")|.)*\\])(?:"+r(o)+"){2}"),l=i.test(e)?i.exec(e)[1]:"";k();var s=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(n))),l="",s="",a=0;a<i.length;a++)l=i[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ne(l).length>0&&(o[l]=s);return o}(l,t);for(var u in s)I([u,s[u]]);if(!("1"!==s.SetUp||"FEN"in s&&P(s.FEN,!0)))return!1;var c=e.replace(l,"").replace(new RegExp(r(o),"g")," ");c=c.replace(/(\{[^}]+\})+?/g,"");for(var f=/(\([^\(\)]+\))+?/g;f.test(c);)c=c.replace(f,"");var h=ne(c=(c=(c=c.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));h=h.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<h.length-1;v++){if(null==(p=V(h[v],n)))return!1;G(p)}if(p=h[h.length-1],a.indexOf(p)>-1)(function(e){for(var t in e)return!0;return!1})(T)&&void 0===T.Result&&I(["Result",p]);else{if(null==(p=V(p,n)))return!1;G(p)}return!0},header:function(){return I(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=g.a8;t<=g.h1;t++){if(0===J(t)&&(e+=" "+"87654321"[Z(t)]+" |"),null==b[t])e+=" . ";else{var r=b[t].type;e+=" "+(b[t].color===n?r.toUpperCase():r.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return A},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=V(e,n);else if("object"==typeof e)for(var o=Q(),i=0,l=o.length;i<l;i++)if(e.from===X(o[i].from)&&e.to===X(o[i].to)&&(!("promotion"in o[i])||e.promotion===o[i].promotion)){r=o[i];break}if(!r)return null;var s=ee(r);return G(r),s},undo:function(){var e=z();return e?ee(e):null},clear:function(){return _()},put:function(e,t){return L(e,t)},get:function(e){return $(e)},remove:function(e){return function(e){var t=$(e);return b[g[e]]=null,t&&t.type===l&&(y[t.color]=r),O(N()),t}(e)},perft:function(e){return re(e)},square_color:function(e){if(e in g){var t=g[e];return(Z(t)+J(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);S.length>0;)t.push(z());for(;t.length>0;){var o=t.pop();r?n.push(ee(o)):n.push(q(o)),G(o)}return n}}};function b(e,t){this.fen=e,this.notation=t,this.toString=function(){return"IllegalMoveException: "+e+" => "+t}}void 0!==g&&(g.$389b963f4edc9b1c$export$a4d6ea685c300d39=m),"undefined"!=typeof define&&define((function(){return m}));class y{clear(){this.moves=[]}traverse(e,t,n,r=1,o=!1){const i=t?new g.Chess(t):new g.Chess,l=[];let s=n;for(let n of e){if(n.notation){const e=n.notation.notation,a=i.move(e,{sloppy:o});if(!a)throw new b(i.fen(),e);{s?(a.previous=s,s.next=a):a.previous=void 0,a.ply=r,this.fillMoveFromChessState(a,i),n.nag&&(a.nag=n.nag[0]),n.commentBefore&&(a.commentBefore=n.commentBefore),n.commentMove&&(a.commentMove=n.commentMove),n.commentAfter&&(a.commentAfter=n.commentAfter),a.variations=[];const e=n.variations;if(e.length>0){const n=l.length>0?l[l.length-1].fen:t;for(let t of e)a.variations.push(this.traverse(t,n,s,r,o))}a.variation=l,l.push(a),s=a}}r++}return l}fillMoveFromChessState(e,t){e.fen=t.fen(),e.variations=[],t.game_over()&&(e.gameOver=!0,t.in_draw()&&(e.inDraw=!0),t.in_stalemate()&&(e.inStalemate=!0),t.insufficient_material()&&(e.insufficientMaterial=!0),t.in_threefold_repetition()&&(e.inThreefoldRepetition=!0),t.in_checkmate()&&(e.inCheckmate=!0)),t.in_check()&&(e.inCheck=!0)}historyToMove(e){const t=[];let n=e;for(t.push(n);n.previous;)t.push(n.previous),n=n.previous;return t.reverse()}addMove(e,t,n=!0){t||this.moves.length>0&&(t=this.moves[this.moves.length-1]);const r=new g.Chess(this.setUpFen?this.setUpFen:void 0);if(t){const e=this.historyToMove(t);for(const t of e)r.move(t)}const o=r.move(e,{sloppy:n});if(!o)throw new Error("invalid move");return this.fillMoveFromChessState(o,r),t?(o.previous=t,o.ply=t.ply+1,t.next?(t.next.variations.push([]),o.variation=t.next.variations[t.next.variations.length-1],o.variation.push(o)):(t.next=o,o.variation=t.variation,t.variation.push(o))):(o.variation=this.moves,o.ply=1,this.moves.push(o)),o}render(){let e="";for(const t of this.moves)e+=t.san+" ";return e}constructor(e,t,n=!1){if(e){const r=class{static parse(e,t){return f(e,t)}}.parse(e.replace(/\s\s+/g," ").replace(/\n/g," "));this.moves=this.traverse(r[0],t,void 0,1,n)}else this.clear();this.setUpFen=t}}var A={};Object.defineProperty(A,"__esModule",{value:!0});var E=/^\s*([prnbqkPRNBQK12345678]{1,8}(?:\/[prnbqkPRNBQK12345678]{1,8}){7})\s+(w|b)\s+([KQkqA-Ha-h]{1,4}|\-)\s+(?:(?:([a-h][36]|\-)\s+(\d{1,3})\s+(\d{1,4}))|(?:0\s+0))\s*$/,C=/[1-8]+/g,x=/\-+/g,w={1:"-",2:"--",3:"---",4:"----",5:"-----",6:"------",7:"-------",8:"--------"},S=function(){function e(e){this.original="",this.isValid=!1,this.positions="",this.ranks=[],this.turn="",this.castles="",this.enpass="",this.halfmoveClock=0,this.moveNumber=0,this.original="string"==typeof e?e:"";var t=this.original.match(E);this.isValid=!!t,t&&(this.positions=t[1],this.ranks=t[1].split("/").map((function(e){return e.replace(C,(function(e){return w[e]}))})),this.turn=t[2],this.castles=t[3],this.enpass=void 0!==t[4]?t[4]:"-",this.halfmoveClock=void 0!==t[5]?parseInt(t[5],10):0,this.moveNumber=void 0!==t[6]?parseInt(t[6],10):1,this.isValid=this.ranks.reduce((function(e,t){return e&&8===t.length}),!0))}return e.prototype.toString=function(){return this.ranks.map((function(e){return e.replace(x,(function(e){return e.length.toString()}))})).join("/")+" "+this.turn+" "+this.castles+" "+this.enpass+" "+this.halfmoveClock+" "+this.moveNumber},e.prototype.hasPiece=function(e){return this.positions.indexOf(e)>=0},e.prototype.counts=function(){for(var e={},t=0,n=this.ranks;t<n.length;t++)for(var r=0,o=n[t];r<o.length;r++){var i=o[r];"-"!==i&&(e[i]=(e[i]||0)+1)}return e},e.isFen=function(e){return"string"==typeof e&&E.test(e)},e}();A.FenParser=S,A.default=S;const T=document.getElementById("prev-js"),_=document.getElementById("play-js"),k=document.getElementById("next-js"),P=document.getElementById("stop-js"),R=document.getElementById("delay-js"),N=[...document.getElementsByClassName("audio-input")];let I={},O=0;const $=new class{render(){let e="";return e+=this.header.render(),e+="\n",e+=this.history.render(),e}constructor(e="",t={}){const n="]"===e.trim().substr(-1)?e.length:e.lastIndexOf("]\n\n")+1,r=e.substr(0,n),o=e.substr(n),i=!!t.sloppy;this.header=new u(r),"1"===this.header.tags[s]&&this.header.tags[a]?this.history=new y(o,this.header.tags[a],i):this.history=new y(o,void 0,i)}}('[Event "Match"]\n[Site "Philadelphie, USA"]\n[Date "1996.02.10"]\n[Round "1"]\n[White "Deep Blue (Computer)"]\n[Black "Garry Kasparov"]\n[Result "1-0"]\n[ECO "B22"]\n[PlyCount "73"]\n[EventDate "1996.??.??"]\n[WhiteElo ""]\n[BlackElo ""]\n\n1. e4 c5 {Garry choisi sa défense favorite contre 1.e4} 2. c3\n{L\'ordinateur évite les grandes lignes en jouant l\'Alapine.} 2... d5 3.\nexd5 Qxd5 4. d4 Nf6 5. Nf3 Bg4 6. Be2 e6 7. h3 Bh5 8. O-O Nc6 9. Be3 cxd4 10.\ncxd4 Bb4 {Un coup assez rare.} (10... Be7 {Est le coup le plus joué dans\ncette position.} 11. Nc3 Qd6) 11. a3 Ba5 12. Nc3 Qd6 13. Nb5 Qe7 14. Ne5 Bxe2\n15. Qxe2 O-O 16. Rac1 Rac8 {Les deux camps ont terminé leur\ndéveloppement et activé toutes leurs pièces. Les blancs\njouent avec un pion isolé et vont devoir être très actifs\npour justifier cette légère faiblesse.} 17. Bg5 Bb6 18. Bxf6 gxf6\n19. Nc4 Rfd8 20. Nxb6 axb6 21. Rfd1 f5 22. Qe3 {Les blancs activent leur dame et\nmenace d\'envahir l\'aile roi adverse.} 22... Qf6 23. d5 Rxd5 24. Rxd5 exd5 25. b3\nKh8 26. Qxb6 Rg8 {Pour compenser leur structure de pions ruinée, les\nnoirs tentent d\'organiser une attaque.} 27. Qc5 d4 $2 (27... f4 {garde la position\n&agrave; peu près égale.}) 28. Nd6 $1 f4 29. Nxb7 Ne5 30. Qd5 f3 31.\ng3 Nd3 32. Rc7 {Les pièces blanches se coordonnent pour attaquer la\nposition noire.} 32... Re8 $4 {L\'erreur fatale.} 33. Nd6 Re1+ 34. Kh2 Nxf2 35.\nNxf7+ Kg7 36. Ng5+ Kh6 37. Rxh7+ {C\'est la première fois qu\'un ordinateur\nbat le champion du monde en cadence classique. Un moment historique  $1} 1-0'),L=$.history.moves.map((t=>new(e(A))(t.fen).ranks)),B=new(e(A))("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");L.unshift(B.ranks);const Q=new function(e){this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.width,this.cellWidth=this.width/8,this.cellHeight=this.height/8,this.draw=function(){this.ctx.clearRect(0,0,this.width,this.height);for(let e=0;e<64;e++){const t=Math.floor(e/8),n=e-8*t,r="rgb(233, 244, 251)";this.ctx.strokeStyle=r,this.ctx.strokeRect(n*this.cellWidth,t*this.cellHeight,this.cellWidth,this.cellHeight)}}}(document.getElementById("chessboard")),q=[];L.forEach((e=>{const s=[];e.forEach(((e,a)=>{[...e].forEach(((e,u)=>{"P"===e?s.push(new t({y:u,x:7-a},!0)):"p"===e?s.push(new t({y:u,x:7-a},!1)):"r"===e?s.push(new n({y:u,x:7-a},!1)):"R"===e?s.push(new n({y:u,x:7-a},!0)):"n"===e?s.push(new r({y:u,x:7-a},!1)):"N"===e?s.push(new r({y:u,x:7-a},!0)):"b"===e?s.push(new o({y:u,x:7-a},!1)):"B"===e?s.push(new o({y:u,x:7-a},!0)):"q"===e?s.push(new i({y:u,x:7-a},!1)):"Q"===e?s.push(new i({y:u,x:7-a},!0)):"k"===e?s.push(new l({y:u,x:7-a},!1)):"K"===e&&s.push(new l({y:u,x:7-a},!0))}))})),q.push(s)}));const K=$.history.moves.map((e=>e.flags));function U(){Q.draw(),q[O].forEach((e=>{e.draw(Q)}))}let D;k.addEventListener("click",(e=>{j(),O=Math.min(O+1,q.length-1),U()})),T.addEventListener("click",(e=>{O=Math.max(O-1,0),U()}));let M=!1;function W(){M=!M,_.innerHTML=M?'<i class="fa fa-pause" aria-hidden="true"></i>':'<i class="fa fa-play" aria-hidden="true"></i>',M?D=window.setInterval((()=>{j(),O++,O>=q.length-1?W():U()}),1e3*R.value):clearInterval(D)}function j(){const e=K[O];console.log(e),I[e]&&I[e].play()}_.addEventListener("click",W),P.addEventListener("click",(e=>{O=0,M&&W(),U()})),N.forEach((e=>{e.addEventListener("change",(e=>{const t=e.target.id;if(!e.target.files.length)return;const n=URL.createObjectURL(e.target.files[0]);I[t]=document.createElement("audio"),I[t].addEventListener("load",(()=>{URL.revokeObjectURL(n)})),I[t].controls="true",I[t].src=n,I[t].play()}))})),U();
//# sourceMappingURL=index.7834227d.js.map
